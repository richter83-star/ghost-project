# Adaptive AI Product Generation System

## Overview

The Adaptive AI system replaces the static Oracle brain with an intelligent, learning product generator that:

- **Learns from sales data** - Analyzes performance across Shopify, Gumroad, and Lemon
- **Adapts to market trends** - Identifies what sells and generates more of it
- **Optimizes pricing** - Uses data-driven price ranges for maximum revenue
- **Predicts performance** - Estimates sales velocity and revenue before generating
- **Continuously improves** - Gets smarter with each generation cycle

## Architecture

### Core Components

1. **Analytics Engine** (`src/lib/adaptive-ai/analytics.ts`)
   - Aggregates sales data from all platforms
   - Analyzes product performance (conversion rates, revenue, trends)
   - Identifies top-performing niches and product types
   - Generates market insights and recommendations

2. **Product Generator** (`src/lib/adaptive-ai/generator.ts`)
   - Creates products based on learned insights
   - Uses AI-enhanced descriptions (Gemini)
   - Calculates expected performance metrics
   - Generates products with confidence scores

3. **Listener** (`src/integrations/adaptive-ai/listener.ts`)
   - Runs on a schedule to continuously generate products
   - Monitors market conditions
   - Adjusts generation frequency based on signals

## Usage

### CLI Commands

#### Analyze Market Insights

```bash
npm run adaptive-ai:analyze
```

Shows:
- Top performing products
- Top performing niches
- Trending product types
- Optimal price ranges
- Recommendations (generate more, adjust pricing, discontinue)

#### Generate Products

```bash
npm run adaptive-ai:generate [count]
```

Generates products based on market insights. Default count is 3.

Example:
```bash
npm run adaptive-ai:generate 5
```

### Integration with Server

The adaptive AI listener can be enabled in `src/server.ts`:

```typescript
import { startAdaptiveAIListener } from './integrations/adaptive-ai/listener.js';

// In main():
if (process.env.ENABLE_ADAPTIVE_AI === 'true') {
  startAdaptiveAIListener();
}
```

Set `ENABLE_ADAPTIVE_AI=true` in your environment to enable automatic generation.

## Configuration

### Environment Variables

```env
# Adaptive AI Settings
ADAPTIVE_AI_GENERATION_INTERVAL_HOURS=24  # How often to generate (default: 24 hours)
ADAPTIVE_AI_MIN_PRODUCTS=3                 # Minimum products per cycle
ADAPTIVE_AI_MAX_PRODUCTS=5                 # Maximum products per cycle
ENABLE_ADAPTIVE_AI=false                   # Enable automatic generation in server

# Required for analytics (sales data integration)
SHOPIFY_STORE_URL=dracanus-ai.myshopify.com
SHOPIFY_ADMIN_API_TOKEN=shpat_xxxxx
GUMROAD_API_KEY=xxxxx                      # Optional, for Gumroad sales analysis
LEMONSQUEEZY_API_KEY=xxxxx                 # Optional, for Lemon Squeezy sales analysis
LEMONSQUEEZY_STORE_ID=xxxxx                # Optional, required if using Lemon Squeezy
GEMINI_API_KEY=xxxxx                       # Required for AI-generated descriptions
```

## How It Works

### 1. Market Analysis

The system analyzes:
- **Sales data** from last 90 days (Shopify, Gumroad, Lemon)
- **Product performance** (revenue, conversion rates, trends)
- **Niche performance** (which niches sell best)
- **Price optimization** (optimal price ranges per product type)

### 2. Strategy Generation

Based on insights, it generates strategies:
- **High confidence** (0.8+): Proven combinations (top performers)
- **Medium confidence** (0.6): Trending types in underserved niches
- **Low confidence** (<0.6): Experimental (not generated by default)

### 3. Product Generation

For each strategy:
1. Selects product template (prompt pack, automation kit, or bundle)
2. Generates AI-enhanced description using Gemini
3. Calculates optimal price within strategy range
4. Estimates expected performance (sales velocity, revenue)
5. Creates Firestore document with `status: "pending"`

### 4. Workflow Integration

Generated products follow the standard workflow:
- `pending` → Nexus listener → `draft`
- `draft` → Shopify pipeline → `published`

## Performance Metrics

Each generated product includes:

- **Expected Sales Velocity**: Sales per day (based on confidence)
- **Expected Revenue**: Monthly revenue estimate
- **Risk Score**: 0-1 (lower is better, inverse of confidence)

## Comparison with Oracle

| Feature | Oracle | Adaptive AI |
|---------|--------|-------------|
| Product Generation | Random templates | Data-driven strategies |
| Pricing | Fixed ranges | Optimized based on performance |
| Learning | None | Continuous from sales data |
| Market Awareness | None | Full market analysis |
| Performance Prediction | None | Expected metrics included |
| Adaptability | Static | Continuously improves |

## Migration from Oracle

The Adaptive AI system is a **drop-in replacement** for Oracle:

1. **Stop Oracle** (if running on a schedule)
2. **Enable Adaptive AI** in server or run manually
3. **Monitor** initial generations to ensure quality
4. **Archive Oracle** once Adaptive AI is proven

Oracle products will continue to work - they're just created with `source: "oracle"` instead of `source: "adaptive_ai"`.

## Troubleshooting

### "No products generated"

**Cause**: Insufficient market data or no viable strategies

**Solution**:
1. Ensure you have sales data (at least some products with sales)
2. Run `npm run adaptive-ai:analyze` to see insights
3. Check if recommendations are being generated

### "Failed to fetch Shopify orders"

**Cause**: Missing or invalid Shopify credentials

**Solution**: Verify `SHOPIFY_STORE_URL` and `SHOPIFY_ADMIN_API_TOKEN` are set correctly

### "No strategies generated"

**Cause**: Market analysis found no clear patterns

**Solution**: 
- Wait for more sales data to accumulate
- Manually create some products to seed the market
- Check that products have proper `niche` and `product_type` fields

## Future Enhancements

- **Customer segmentation** - Generate products for specific customer segments
- **Seasonal trends** - Adapt to seasonal patterns
- **A/B testing** - Test different product variations
- **Competitor analysis** - Learn from competitor products
- **Advanced pricing** - Dynamic pricing based on demand

